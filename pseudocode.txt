FUNCTION derive_key(password: STRING, salt: BYTES) ‚Üí BYTES
    CREATE kdf dengan:
        - Algorithm: SHA256
        - Length: 32 bytes
        - Salt: parameter salt
        - Iterations: 100000
    
    RETURN kdf.derive(password diubah ke bytes)
END FUNCTION


FUNCTION encrypt_text(plaintext: STRING, password: STRING) ‚Üí DICTIONARY
    GENERATE salt RANDOM 16 bytes
    GENERATE iv RANDOM 16 bytes
    
    key ‚Üê derive_key(password, salt)
    
    padder ‚Üê CREATE PKCS7 padding (block size 128 bits)
    padded_data ‚Üê padder.apply(plaintext diubah ke bytes)
    
    cipher ‚Üê CREATE AES cipher dengan:
        - Algorithm: AES
        - Key: key
        - Mode: CBC
        - IV: iv
    
    encryptor ‚Üê GET encryptor dari cipher
    ciphertext ‚Üê encryptor.process(padded_data)
    
    RETURN dictionary dengan:
        - ciphertext (base64 encoded)
        - iv (base64 encoded)
        - salt (base64 encoded)
END FUNCTION


FUNCTION decrypt_text(encrypted_data: DICTIONARY, password: STRING) ‚Üí STRING
    ciphertext ‚Üê DECODE base64 dari encrypted_data['ciphertext']
    iv ‚Üê DECODE base64 dari encrypted_data['iv']
    salt ‚Üê DECODE base64 dari encrypted_data['salt']
    
    key ‚Üê derive_key(password, salt)
    
    cipher ‚Üê CREATE AES cipher dengan:
        - Algorithm: AES
        - Key: key
        - Mode: CBC
        - IV: iv
    
    decryptor ‚Üê GET decryptor dari cipher
    padded_plaintext ‚Üê decryptor.process(ciphertext)
    
    unpadder ‚Üê CREATE PKCS7 unpadding (block size 128 bits)
    plaintext ‚Üê unpadder.remove(padded_plaintext)
    
    RETURN plaintext diubah ke STRING
END FUNCTION


FUNCTION upload_file() ‚Üí STRING atau NULL
    PRINT "üì§ Silakan pilih file untuk diupload..."
    
    uploaded ‚Üê REQUEST user upload file
    
    IF uploaded kosong THEN
        RETURN NULL
    END IF
    
    filename ‚Üê EXTRACT nama file dari uploaded
    PRINT "‚úì File berhasil diupload: " + filename
    
    RETURN filename
END FUNCTION


FUNCTION encrypt_file(input_file: STRING, output_file: STRING, password: STRING) ‚Üí DICTIONARY
    CHECK ukuran file
    
    IF ukuran file > 1 MB THEN
        RAISE exception "Ukuran file melebihi 1 MB"
    END IF
    
    plaintext ‚Üê READ file input_file
    
    encrypted_data ‚Üê encrypt_text(plaintext, password)
    
    CREATE output_file dan WRITE encrypted_data (format JSON)
    
    PRINT "‚úì File berhasil dienkripsi: " + output_file
    
    RETURN encrypted_data
END FUNCTION


FUNCTION decrypt_file(input_file: STRING, output_file: STRING, password: STRING) ‚Üí STRING
    encrypted_data ‚Üê READ dan PARSE JSON dari input_file
    
    plaintext ‚Üê decrypt_text(encrypted_data, password)
    
    CREATE output_file dan WRITE plaintext
    
    PRINT "‚úì File berhasil didekripsi: " + output_file
    
    RETURN plaintext
END FUNCTION


FUNCTION main()
    PRINT header aplikasi
    
    WHILE TRUE DO
        DISPLAY menu options (1-4 dan 0 untuk keluar)
        choice ‚Üê INPUT user pilihan
        
        TRY
            CASE choice OF
            
                CASE '1': // Enkripsi Teks
                    plaintext ‚Üê INPUT "Teks yang akan dienkripsi"
                    password ‚Üê INPUT "Password"
                    
                    IF plaintext kosong OR password kosong THEN
                        PRINT error message
                        CONTINUE ke iterasi berikutnya
                    END IF
                    
                    encrypted ‚Üê encrypt_text(plaintext, password)
                    output_file ‚Üê CREATE filename dengan timestamp
                    
                    WRITE encrypted ke output_file (format JSON)
                    
                    PRINT "‚úì BERHASIL DIENKRIPSI!"
                    PRINT details (ciphertext, IV, salt)
                
                
                CASE '2': // Dekripsi Teks
                    PRINT "üì§ Upload file JSON hasil enkripsi..."
                    json_file ‚Üê upload_file()
                    
                    IF json_file NULL THEN
                        PRINT "‚ùå Upload dibatalkan!"
                        CONTINUE
                    END IF
                    
                    encrypted_data ‚Üê READ dan PARSE JSON dari json_file
                    password ‚Üê INPUT "Password"
                    
                    IF password kosong THEN
                        PRINT error message
                        CONTINUE
                    END IF
                    
                    plaintext ‚Üê decrypt_text(encrypted_data, password)
                    output_file ‚Üê CREATE filename dengan timestamp
                    
                    WRITE plaintext ke output_file
                    
                    PRINT "‚úì BERHASIL DIDEKRIPSI!"
                    PRINT hasil dekripsi
                
                
                CASE '3': // Enkripsi File
                    PRINT "üì§ Upload file yang akan dienkripsi..."
                    input_file ‚Üê upload_file()
                    
                    IF input_file NULL THEN
                        PRINT "‚ùå Upload dibatalkan!"
                        CONTINUE
                    END IF
                    
                    password ‚Üê INPUT "Password"
                    
                    IF password kosong THEN
                        PRINT error message
                        CONTINUE
                    END IF
                    
                    original_content ‚Üê READ binary dari input_file
                    plaintext ‚Üê CONVERT ke STRING
                    encrypted ‚Üê encrypt_text(plaintext, password)
                    
                    metadata ‚Üê CREATE dictionary dengan:
                        - original_filename
                        - ciphertext, iv, salt
                    
                    output_file ‚Üê input_file + "_encrypted.json"
                    WRITE metadata ke output_file (format JSON)
                    
                    PRINT "‚úì FILE BERHASIL DIENKRIPSI!"
                    PRINT file input dan output
                
                
                CASE '4': // Dekripsi File
                    PRINT "üì§ Upload file JSON terenkripsi..."
                    json_file ‚Üê upload_file()
                    
                    IF json_file NULL THEN
                        PRINT "‚ùå Upload dibatalkan!"
                        CONTINUE
                    END IF
                    
                    metadata ‚Üê READ dan PARSE JSON dari json_file
                    password ‚Üê INPUT "Password"
                    
                    IF password kosong THEN
                        PRINT error message
                        CONTINUE
                    END IF
                    
                    encrypted_data ‚Üê CREATE dictionary dari metadata
                    plaintext ‚Üê decrypt_text(encrypted_data, password)
                    
                    original_filename ‚Üê GET dari metadata
                    output_file ‚Üê "decrypted_" + original_filename
                    
                    WRITE plaintext ke output_file
                    
                    PRINT "‚úì FILE BERHASIL DIDEKRIPSI!"
                    PRINT file output dan format asli
                
                
                CASE '0': // Keluar
                    BREAK dari WHILE loop
                
                
                ELSE:
                    PRINT "‚ùå Pilihan tidak valid!"
            
            END CASE
        
        CATCH exception AS e
            PRINT "‚ùå Error: " + error message
            PRINT "üí° Tips: Pastikan password benar dan file format valid"
        
        END TRY
    
    END WHILE
END FUNCTION